DECLARE
ROW_COUNT NUMBER;
BEGIN
    SELECT count(*) into ROW_COUNT FROM user_tables where table_name = 'USERS';
    IF(ROW_COUNT > 0)
    THEN
        DBMS_OUTPUT.PUT_LINE('TABLE USERS ALREADY EXISTS');
    ELSE
        EXECUTE IMMEDIATE 'CREATE TABLE USERS
    (
      USER_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY
    , PHONE NUMBER(10)
    , PWD VARCHAR2(10) NOT NULL 
    , EMERGENCY_CONTACT VARCHAR2(10) NOT NULL 
    , LOCATION_ID NUMBER(10) NOT NULL 
    , RISK_STATUS INT 
    , LAST_NAME VARCHAR2(10) 
    , FIRST_NAME VARCHAR2(10) NOT NULL 
    , DOB DATE NOT NULL 
    , JOIN_DATE DATE DEFAULT SYSDATE
    , GROUPS_ID NUMBER(10) DEFAULT 1 
    , EMAIL VARCHAR2(10) NOT NULL 
    ,  CONSTRAINT USERS_PK PRIMARY KEY(USER_ID)
    ,  CONSTRAINT EMAIL_VALIDATION CHECK(REGEXP_LIKE(EMAIL,''^[A-Za-z]+[A-Za-z0-9.]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$''))
    ,  CONSTRAINT PHONE_VALIDATION CHECK(REGEXP_LIKE(PHONE, ''^[0-9]{10}$''))
    ,  CONSTRAINT USERS_FK_LOCATION FOREIGN KEY (LOCATION_ID) REFERENCES LOCATION(LOCATION_ID)
    ,  CONSTRAINT USERS_FK_GROUPS FOREIGN KEY (GROUPS_ID) REFERENCES GROUPS(GROUPS_ID) 
    )
    ';    
     DBMS_OUTPUT.PUT_LINE('TABLE USERS CREATED SUCCESSFULLY');
    END IF;
END;
/


CREATE TABLE USERS_1
(
  USER_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY
, PHONE NUMBER(10)
, PWD VARCHAR2(10) NOT NULL 
, EMERGENCY_CONTACT VARCHAR2(10) NOT NULL 
, LOCATION_ID NUMBER(10) NOT NULL 
, RISK_STATUS INT 
, LAST_NAME VARCHAR2(10) 
, FIRST_NAME VARCHAR2(10) NOT NULL 
, DOB DATE NOT NULL 
, JOIN_DATE DATE DEFAULT SYSDATE
, GROUPS_ID NUMBER(10) DEFAULT 1 
, EMAIL VARCHAR2(10) NOT NULL 
,  CONSTRAINT USERS_1_PK PRIMARY KEY(USER_ID)
,  CONSTRAINT EMAIL_VALIDATION CHECK(REGEXP_LIKE(EMAIL,'^[A-Za-z]+[A-Za-z0-9.]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$'))
,  CONSTRAINT PHONE_VALIDATION CHECK(REGEXP_LIKE(PHONE, '^[0-9]{10}$'))
,  CONSTRAINT USERS_1_FK_LOCATION FOREIGN KEY (LOCATION_ID) REFERENCES LOCATION(LOCATION_ID)
,  CONSTRAINT USERS_1_FK_GROUPS FOREIGN KEY (GROUPS_ID) REFERENCES GROUPS(GROUPS_ID) 

);

DROP TABLE USERS_1;

